<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Lousa CIPA - Linha do Tempo (NR-05)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#f5f6fa; --card:#fff; --ink:#2c3e50; --muted:#34495e; --pill:#3498db;
      --accent:#27ae60; --accent2:#2ecc71; --item:#ecf0f1; --bar:#2980b9;
    }
    *{box-sizing:border-box}
    body{font-family:Arial,Helvetica,sans-serif;background:var(--bg);margin:0}
    header{background:var(--ink);color:#fff;text-align:center;padding:20px}
    main{
      max-width:900px;margin:30px auto;background:var(--card);border-radius:12px;
      padding:22px;box-shadow:0 6px 20px rgba(0,0,0,.08)
    }
    h1,h2{margin:0 0 16px}
    h2{color:var(--muted);text-align:center}
    label{font-weight:700}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:end}
    input[type="date"]{
      padding:10px;font-size:16px;border:1px solid #ccd;border-radius:8px
    }
    button{
      padding:12px 18px;background:var(--accent);border:0;color:#fff;border-radius:8px;
      font-size:16px;cursor:pointer
    }
    button:hover{background:var(--accent2)}
    #results{margin-top:26px;display:none}
    #results ul{list-style:none;padding:0;margin:0}
    #results li{
      background:var(--item);margin:14px 0;padding:16px 16px 14px;border-radius:10px;
      border-left:6px solid var(--bar);position:relative
    }
    #results li::before{
      content:"üìå";position:absolute;left:-30px;top:14px;font-size:20px
    }
    .stage-name{font-weight:800;color:var(--ink)}
    .date-info{
      float:right;font-size:14px;font-weight:700;background:var(--pill);
      color:#fff;padding:6px 12px;border-radius:20px;margin-left:10px
    }
    .hint{display:block;font-size:12px;color:#555;margin-top:6px;line-height:1.35}
    .warn{
      margin-top:14px;background:#fff3cd;border:1px solid #ffe29a;color:#7a5b00;
      padding:10px 12px;border-radius:8px;font-size:14px
    }
    footer{
      margin-top:24px;font-size:12px;color:#666;display:flex;gap:8px;flex-wrap:wrap;
      align-items:center;justify-content:space-between
    }
    .badge{background:#eef3ff;color:#234;padding:6px 10px;border-radius:999px;font-weight:700}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:700px){.grid{grid-template-columns:1fr}}
    .pill{display:inline-block;background:#eef3ff;color:#234;padding:4px 10px;border-radius:999px;font-size:12px;margin-left:6px}
  </style>
</head>
<body>
  <header>
    <h1>Lousa ‚Äì Cronograma Eleitoral da CIPA (NR-05)</h1>
  </header>

  <main>
    <h2>Informe a data de t√©rmino do mandato atual</h2>
    <div class="row">
      <div>
        <label for="endDate">Data de t√©rmino:</label><br/>
        <input type="date" id="endDate" aria-label="Data de t√©rmino do mandato atual">
      </div>
      <button id="calculateBtn" aria-label="Gerar Linha do Tempo">Gerar Linha do Tempo</button>
    </div>

    <div id="results">
      <h2>üìÖ Linha do Tempo</h2>
      <div id="alerts"></div>
      <ul></ul>

      <footer>
        <div class="badge">Base legal: NR-05 (itens 5.4.7; 5.5.1; 5.5.3 a‚Äìb, f‚Äìg)</div>
        <div>Este cronograma auxilia a gest√£o e <b>n√£o substitui</b> a leitura integral da NR-05.</div>
      </footer>
    </div>
  </main>

  <script>
    const calculateBtn = document.getElementById('calculateBtn');
    const endDateInput = document.getElementById('endDate');
    const resultsDiv = document.getElementById('results');
    const resultsList = resultsDiv.querySelector('ul');
    const alertsDiv = document.getElementById('alerts');

    const dayNames = ['Domingo','Segunda-feira','Ter√ßa-feira','Quarta-feira','Quinta-feira','Sexta-feira','S√°bado'];

    function formatDate(date){
      const d = String(date.getDate()).padStart(2,'0');
      const m = String(date.getMonth()+1).padStart(2,'0');
      const y = date.getFullYear();
      const dow = dayNames[date.getDay()];
      return `${d}/${m}/${y} (${dow})`;
    }
    function clone(d){ return new Date(d.getTime()); }
    function isWeekend(d){ const g=d.getDay(); return g===0 || g===6; }

    // Ajustes de DIA √öTIL apenas quando a NR exige:
    function toBusinessDayBackward(d){
      const x = clone(d);
      while(isWeekend(x)) x.setDate(x.getDate()-1);
      return x;
    }
    function toBusinessDayForward(d){
      const x = clone(d);
      while(isWeekend(x)) x.setDate(x.getDate()+1);
      return x;
    }

    function addItem(stage, date, hint){
      const li = document.createElement('li');
      li.innerHTML = `
        <span class="stage-name">${stage}</span>
        <span class="date-info">${formatDate(date)}</span>
        ${hint ? `<span class="hint">${hint}</span>` : ``}
      `;
      resultsList.appendChild(li);
    }

    function addWarning(msg){
      const div = document.createElement('div');
      div.className = 'warn';
      div.textContent = msg;
      alertsDiv.appendChild(div);
    }

    calculateBtn.addEventListener('click', () => {
      alertsDiv.innerHTML = '';
      resultsList.innerHTML = '';
      const endDateStr = endDateInput.value;

      if(!endDateStr){
        alert('Por favor, selecione a data de t√©rmino do mandato atual.');
        return;
      }

      // Data de t√©rmino do mandato (00:00 local)
      const endDate = new Date(endDateStr + 'T00:00:00');

      // Valida√ß√£o simples: se t√©rmino j√° passou, alertar
      const today = new Date(); today.setHours(0,0,0,0);
      if(endDate < today){
        addWarning('Aten√ß√£o: a data de t√©rmino informada j√° passou. Reveja o per√≠odo do mandato.');
      }

      // 1) CONVOCA√á√ÉO (NR-05 5.5.1): m√≠nimo 60 dias antes do t√©rmino.
      // N√£o ajustamos para dia √∫til (a NR n√£o exige dia √∫til para convoca√ß√£o).
      const convocacao = clone(endDate);
      convocacao.setDate(convocacao.getDate() - 60);

      // 2) ELEI√á√ÉO (NR-05 5.5.3 f, g): m√≠nimo 30 dias antes do t√©rmino + em dia normal de trabalho.
      let eleicaoBase = clone(endDate);
      eleicaoBase.setDate(eleicaoBase.getDate() - 30);
      const eleicao = toBusinessDayBackward(eleicaoBase); // garante dia √∫til sem diminuir o intervalo m√≠nimo

      // 3) EDITAL + ABERTURA DE INSCRI√á√ïES (NR-05 5.5.3 a‚Äìb):
      // Per√≠odo m√≠nimo de 15 dias corridos. Para n√£o "inventar" prazos,
      // definimos a data MAIS TARDIA poss√≠vel que ainda cumpre o m√≠nimo de 15 dias antes da elei√ß√£o.
      let inscricoesInicio = clone(eleicao);
      inscricoesInicio.setDate(inscricoesInicio.getDate() - 15); // janela m√≠nima de 15 dias corridos
      // A NR n√£o exige dia √∫til para abrir inscri√ß√µes/publicar edital, ent√£o n√£o ajustamos automaticamente.

      // Encerramento das inscri√ß√µes: "m√≠nimo 15 dias corridos".
      // Para representar 15 dias corridos completos, mostramos de In√≠cio at√© In√≠cio+14 (15 dias incluindo o 1¬∫ dia).
      let inscricoesFim = clone(inscricoesInicio);
      inscricoesFim.setDate(inscricoesFim.getDate() + 14);

      // Checagens de consist√™ncia (avisos, sem mudar prazos legais):
      if(eleicao < convocacao){
        addWarning('Aten√ß√£o: a data de elei√ß√£o caiu antes da convoca√ß√£o calculada. Verifique a data de t√©rmino.');
      }
      if(inscricoesFim >= eleicao){
        addWarning('Aten√ß√£o: o encerramento m√≠nimo das inscri√ß√µes coincide/ultrapassa a data de elei√ß√£o. Considere abrir inscri√ß√µes antes para publicar a rela√ß√£o de inscritos (NR-05 5.5.3 e) com anteced√™ncia adequada.');
      }

      resultsDiv.style.display = 'block';

      // Itens
      addItem(
        'Convoca√ß√£o das elei√ß√µes (NR-05, 5.5.1)',
        convocacao,
        'Convocar elei√ß√µes com anteced√™ncia m√≠nima de 60 dias em rela√ß√£o ao t√©rmino do mandato.'
      );

      addItem(
        'Publica√ß√£o do edital e abertura das inscri√ß√µes (NR-05, 5.5.3 a‚Äìb)',
        inscricoesInicio,
        'Inscri√ß√£o com per√≠odo m√≠nimo de 15 dias corridos. Esta √© a data mais tardia poss√≠vel para ainda cumprir o m√≠nimo antes da elei√ß√£o.'
      );

      addItem(
        'Per√≠odo m√≠nimo de inscri√ß√µes (NR-05, 5.5.3 b)',
        inscricoesInicio,
        `Janela m√≠nima: ${formatDate(inscricoesInicio)} a ${formatDate(inscricoesFim)} (15 dias corridos).`
      );

      addItem(
        'Elei√ß√£o (NR-05, 5.5.3 f, g)',
        eleicao,
        'Deve ocorrer com anteced√™ncia m√≠nima de 30 dias em rela√ß√£o ao t√©rmino e em dia normal de trabalho.'
      );

      // 4) POSSE (NR-05 5.4.7): 1¬∫ dia √∫til ap√≥s o t√©rmino
      const posse = toBusinessDayForward(new Date(endDate.getFullYear(), endDate.getMonth(), endDate.getDate()+1));
      addItem(
        'Posse (NR-05, 5.4.7)',
        posse,
        'Empossar os membros no primeiro dia √∫til ap√≥s o t√©rmino do mandato anterior.'
      );

      // 5) Fim do Mandato Atual (informativo)
      addItem('Fim do mandato atual', endDate, 'Data de t√©rmino informada.');
    });
  </script>
</body>
</html>
