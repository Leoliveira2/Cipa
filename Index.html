<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Lousa CIPA - Linha do Tempo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f6fa;
      margin: 0;
      padding: 0;
    }

    header {
      background: #2c3e50;
      color: white;
      text-align: center;
      padding: 20px;
    }

    main {
      max-width: 800px;
      margin: 30px auto;
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #34495e;
    }

    label {
      font-weight: bold;
    }

    input[type="date"] {
      padding: 8px;
      font-size: 16px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    button {
      padding: 10px 20px;
      background: #27ae60;
      border: none;
      color: white;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }

    button:hover {
      background: #2ecc71;
    }

    #results {
      margin-top: 30px;
      display: none;
    }

    #results ul {
      list-style: none;
      padding: 0;
    }

    #results li {
      background: #ecf0f1;
      margin: 12px 0;
      padding: 15px;
      border-radius: 6px;
      border-left: 5px solid #2980b9;
      position: relative;
    }

    #results li::before {
      content: "üìå";
      position: absolute;
      left: -32px;
      top: 15px;
      font-size: 20px;
    }

    .stage-name {
      font-weight: bold;
      color: #2c3e50;
    }

    .date-info {
      float: right;
      font-size: 16px;
      font-weight: bold;
      color: #2c3e50;
      background: #3498db;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      margin-left: 10px;
    }

    .referencia {
      display: block;
      font-size: 13px;
      color: #555;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Lousa - Cronograma Eleitoral da CIPA</h1>
  </header>

  <main>
    <h2>Informe a data de t√©rmino do mandato atual</h2>
    <label for="endDate">Data de t√©rmino:</label>
    <input type="date" id="endDate">
    <br>
    <button id="calculateBtn">Gerar Linha do Tempo</button>

    <div id="results">
      <h2>üìÖ Linha do Tempo</h2>
      <ul></ul>
    </div>
  </main>

  <script>
    var calculateBtn = document.getElementById('calculateBtn');
    var endDateInput = document.getElementById('endDate');
    var resultsDiv = document.getElementById('results');
    var resultsUlCollection = resultsDiv.getElementsByTagName('ul');
    var resultsList = resultsUlCollection.length > 0 ? resultsUlCollection[0] : null;

    var dayNames = ['Domingo', 'Segunda-feira', 'Ter√ßa-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'S√°bado'];

    function pad2(v) {
      return ('0' + v).slice(-2);
    }

    function formatDate(date) {
      var day = pad2(date.getDate());
      var month = pad2(date.getMonth() + 1);
      var year = date.getFullYear();
      var dayOfWeek = dayNames[date.getDay()];
      return day + '/' + month + '/' + year + ' (' + dayOfWeek + ')';
    }

    // Ajuste para pular final de semana (s√°bados e domingos)
    function ajustarParaDiaUtil(date) {
      while (date.getDay() === 0 || date.getDay() === 6) { // 0 = Domingo, 6 = S√°bado
        date.setDate(date.getDate() + 1);
      }
      return date;
    }

    function addTimelineItem(stage, date, referencia) {
      if (!resultsList) {
        return;
      }

      var li = document.createElement('li');
      li.innerHTML = '<span class="stage-name">' + stage + '</span>' +
        '<span class="date-info">' + formatDate(date) + '</span>' +
        '<span class="referencia">' + referencia + '</span>';
      resultsList.appendChild(li);
    }

    function parseInputDate(value) {
      if (!value) {
        return null;
      }

      var parts;
      var year;
      var month;
      var day;

      if (value.indexOf('-') !== -1) {
        parts = value.split('-');
        if (parts.length === 3) {
          year = parseInt(parts[0], 10);
          month = parseInt(parts[1], 10);
          day = parseInt(parts[2], 10);
          if (!isNaN(year) && !isNaN(month) && !isNaN(day)) {
            return new Date(year, month - 1, day);
          }
        }
      }

      if (value.indexOf('/') !== -1) {
        parts = value.split('/');
        if (parts.length === 3) {
          var first = parseInt(parts[0], 10);
          var second = parseInt(parts[1], 10);
          var third = parseInt(parts[2], 10);

          if (!isNaN(first) && !isNaN(second) && !isNaN(third)) {
            if (first > 12) {
              day = first;
              month = second;
            } else if (second > 12) {
              day = second;
              month = first;
            } else {
              day = first;
              month = second;
            }
            year = third;
            return new Date(year, month - 1, day);
          }
        }
      }

      var parsed = new Date(value);
      if (!isNaN(parsed.getTime())) {
        return parsed;
      }

      return null;
    }

    function bindClick(element, handler) {
      if (element.addEventListener) {
        element.addEventListener('click', handler);
      } else if (element.attachEvent) {
        element.attachEvent('onclick', handler);
      } else {
        element.onclick = handler;
      }
    }

    bindClick(calculateBtn, function () {
      var endDateString = endDateInput.value;

      var endDate = parseInputDate(endDateString);

      if (!endDate) {
        alert('Por favor, selecione a data de vencimento do mandato atual.');
        return;
      }

      if (resultsList) {
        resultsList.innerHTML = '';
      }
      if (resultsDiv) {
        resultsDiv.style.display = 'block';
      }

      // 1. Convoca√ß√£o das elei√ß√µes (60 dias antes do t√©rmino - NR-05 5.5.1)
      var convocacao = new Date(endDate);
      convocacao.setDate(convocacao.getDate() - 60);
      ajustarParaDiaUtil(convocacao);
      addTimelineItem('Convoca√ß√£o das elei√ß√µes (NR-05, 5.5.1)', new Date(convocacao), 'Convoca√ß√£o: pelo menos 60 dias antes do fim do mandato - NR-05, 5.5.1');

      // 2. Publica√ß√£o do Edital/Inscri√ß√µes (45 dias antes do t√©rmino - NR-05 5.5.3.a, 5.6.4.1)
      var edital = new Date(endDate);
      edital.setDate(edital.getDate() - 45);
      ajustarParaDiaUtil(edital);
      addTimelineItem('Publica√ß√£o do Edital/In√≠cio das Inscri√ß√µes (NR-05, 5.5.3.a, 5.6.4.1)', new Date(edital), 'Edital: m√≠nimo 45 dias antes do fim do mandato - NR-05, 5.5.3.a, 5.6.4.1');

      // 3. Encerramento das Inscri√ß√µes (m√≠nimo 15 dias corridos ap√≥s o edital - NR-05 5.5.3.b)
      var inscricoesFim = new Date(edital);
      inscricoesFim.setDate(inscricoesFim.getDate() + 15);
      ajustarParaDiaUtil(inscricoesFim);
      addTimelineItem('Encerramento das Inscri√ß√µes (NR-05, 5.5.3.b)', new Date(inscricoesFim), 'Inscri√ß√µes: m√≠nimo de 15 dias corridos - NR-05, 5.5.3.b');

      // 4. Data da Elei√ß√£o (m√≠nimo 30 dias antes do fim - NR-05 5.5.3.f)
      var eleicao = new Date(endDate);
      eleicao.setDate(eleicao.getDate() - 30);
      ajustarParaDiaUtil(eleicao);
      addTimelineItem('Elei√ß√£o (NR-05, 5.5.3.f)', new Date(eleicao), 'Elei√ß√£o: m√≠nimo 30 dias antes do fim do mandato - NR-05, 5.5.3.f');

      // 5. Posse (primeiro dia √∫til subsequente ao fim do mandato - NR-05 5.4.7)
      var posse = new Date(endDate);
      posse.setDate(posse.getDate() + 1);
      ajustarParaDiaUtil(posse);
      addTimelineItem('Posse (NR-05, 5.4.7)', new Date(posse), 'Posse: primeiro dia √∫til ap√≥s fim do mandato - NR-05, 5.4.7');

      // 6. Fim do Mandato Atual
      addTimelineItem('Fim do Mandato Atual', endDate, 'T√©rmino do mandato atual');
    });
  </script>
</body>
</html>
